<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Reader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 40px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .description {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card h2 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
        }
        
        .result h3 {
            margin-bottom: 10px;
        }
        
        .sms-content {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .instructions {
            margin-top: 30px;
        }
        
        .instructions ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .compatibility {
            margin-top: 20px;
            font-size: 0.9rem;
            text-align: center;
            opacity: 0.8;
        }
        
        .icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .status {
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="icon">📱</span> SMS Reader</h1>
        
        <p class="description">
            This website can read SMS messages from your phone when you click the button below. 
            It uses the WebOTP API to securely access one-time password messages.
        </p>
        
        <div class="card">
            <h2><span class="icon">🔒</span> Privacy & Security</h2>
            <p>Your SMS data is processed locally on your device and is not sent to any server. 
            The website only has access to SMS messages that contain OTP codes and only after you grant permission.</p>
        </div>
        
        <div class="card">
            <h2><span class="icon">📨</span> Read SMS</h2>
            <p>Click the button below to start reading SMS messages from your device.</p>
            
            <div class="status" id="status">Checking browser compatibility...</div>
            
            <div class="warning" id="warning" style="display: none;">
                <strong>Important:</strong> WebOTP API requires specific conditions to work. See instructions below.
            </div>
            
            <button class="btn" id="readSmsBtn">Read SMS Messages</button>
            
            <div class="result" id="result">
                <h3>Retrieved SMS:</h3>
                <div class="sms-content" id="smsContent">No SMS content yet.</div>
                <div class="debug-info" id="debugInfo"></div>
            </div>
        </div>
        
        <div class="card instructions">
            <h2><span class="icon">📋</span> Instructions & Requirements</h2>
            <ol>
                <li><strong>Browser:</strong> Chrome for Android 84+ or Edge for Android 84+</li>
                <li><strong>Device:</strong> Android phone (doesn't work on iOS or desktop)</li>
                <li><strong>Connection:</strong> Must be using HTTPS (GitHub Pages provides this)</li>
                <li><strong>SMS Format:</strong> Message must contain an OTP code with specific formatting</li>
                <li><strong>Timing:</strong> SMS should arrive while the page is open</li>
                <li><strong>Permission:</strong> Grant permission when browser prompts</li>
            </ol>
        </div>
        
        <div class="compatibility">
            <p>Note: This feature requires very specific conditions and may not work on all devices.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const readSmsBtn = document.getElementById('readSmsBtn');
            const resultDiv = document.getElementById('result');
            const smsContent = document.getElementById('smsContent');
            const statusDiv = document.getElementById('status');
            const debugInfo = document.getElementById('debugInfo');
            const warningDiv = document.getElementById('warning');
            
            // Debug information
            let debugData = {
                userAgent: navigator.userAgent,
                isHTTPS: window.location.protocol === 'https:',
                webOTPSupported: false,
                platform: navigator.platform,
                isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
            };
            
            // Check if WebOTP API is supported
            if ('OTPCredential' in window) {
                debugData.webOTPSupported = true;
                statusDiv.textContent = "✅ WebOTP API is supported on your browser";
                statusDiv.style.color = "#4caf50";
                readSmsBtn.disabled = false;
                
                // Show warning about requirements
                warningDiv.style.display = 'block';
                
            } else {
                statusDiv.textContent = "❌ WebOTP API is not supported on your browser";
                statusDiv.style.color = "#ff6b6b";
                readSmsBtn.disabled = true;
                debugData.webOTPSupported = false;
            }
            
            // Update debug info
            updateDebugInfo();
            
            readSmsBtn.addEventListener('click', async function() {
                statusDiv.textContent = "🔄 Requesting SMS access... (Check your phone for permission prompt)";
                statusDiv.style.color = "#ff9800";
                readSmsBtn.disabled = true;
                
                try {
                    // Add a timeout for the WebOTP API call
                    const abortController = new AbortController();
                    const timeoutId = setTimeout(() => {
                        abortController.abort();
                    }, 30000); // 30 second timeout
                    
                    // Use the WebOTP API to read the SMS
                    const content = await navigator.credentials.get({
                        otp: { transport: ['sms'] },
                        signal: abortController.signal
                    });
                    
                    clearTimeout(timeoutId);
                    
                    // Display the SMS content
                    if (content && content.code) {
                        smsContent.textContent = `✅ OTP Code Found!\n\nCode: ${content.code}\nType: ${content.type || 'SMS'}`;
                        statusDiv.textContent = "✅ SMS read successfully!";
                        statusDiv.style.color = "#4caf50";
                    } else {
                        smsContent.textContent = "ℹ️ No OTP code found in the SMS message.\n\nThis could mean:\n- No recent OTP messages\n- Message format not recognized\n- Permission not granted";
                        statusDiv.textContent = "ℹ️ No OTP code detected";
                        statusDiv.style.color = "#ff9800";
                    }
                } catch (error) {
                    console.error('Error reading SMS:', error);
                    
                    // Handle different error cases
                    let errorMessage = "Unknown error occurred";
                    let errorColor = "#ff6b6b";
                    
                    if (error.name === 'AbortError') {
                        errorMessage = "⏰ SMS reading timed out (30 seconds) - no message received";
                        errorColor = "#ff9800";
                    } else if (error.name === 'NotAllowedError') {
                        errorMessage = "❌ Permission denied by user or browser settings";
                    } else if (error.name === 'NotSupportedError') {
                        errorMessage = "❌ WebOTP API not supported by your browser";
                    } else if (error.name === 'InvalidStateError') {
                        errorMessage = "⚠️ Another request is already in progress";
                    } else {
                        errorMessage = `❌ Error: ${error.message || error.name}`;
                    }
                    
                    statusDiv.textContent = errorMessage;
                    statusDiv.style.color = errorColor;
                    
                    // Show detailed error information
                    smsContent.textContent = `Failed to read SMS:\n\nError: ${error.name}\nMessage: ${error.message}\n\nWhat to try:\n1. Ensure you're on Android with Chrome/Edge\n2. Make sure you have OTP messages\n3. Grant permission when prompted\n4. Try sending a test OTP while this page is open`;
                } finally {
                    readSmsBtn.disabled = false;
                    updateDebugInfo();
                }
            });
            
            function updateDebugInfo() {
                debugInfo.innerHTML = `
                    <strong>Debug Information:</strong><br>
                    User Agent: ${debugData.userAgent.substring(0, 100)}...<br>
                    HTTPS: ${debugData.isHTTPS ? '✅ Yes' : '❌ No'}<br>
                    WebOTP Supported: ${debugData.webOTPSupported ? '✅ Yes' : '❌ No'}<br>
                    Platform: ${debugData.platform}<br>
                    Mobile Device: ${debugData.isMobile ? '✅ Yes' : '❌ No'}<br>
                    Current URL: ${window.location.href}
                `;
            }
            
            // Test function to simulate SMS reception (for demo purposes)
            window.testSMS = function() {
                smsContent.textContent = "🧪 Demo SMS Content (for testing):\n\nYour verification code is: 987654\n\nFrom: TestApp\nExpires: 10 minutes\n\nThis is a simulated message for testing purposes.";
                statusDiv.textContent = "🧪 Demo mode activated";
                statusDiv.style.color = "#9c27b0";
                resultDiv.style.display = 'block';
            };
        });
    </script>
</body>
</html>
