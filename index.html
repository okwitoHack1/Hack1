<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Market Onitsha - African Marketplace</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2c5aa0;
            --primary-dark: #1e3d72;
            --primary-light: #4a7bc8;
            --secondary: #f8b500;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --gray: #95a5a6;
            --white: #ffffff;
            --black: #2c3e50;
            
            --bg-color: #ffffff;
            --text-color: #2c3e50;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
            --footer-bg: #2c3e50;
            --border-color: #ecf0f1;
            
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --header-bg: #2d2d2d;
            --footer-bg: #1a1a1a;
            --border-color: #444444;
            --light: #444444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }

        /* Header Styles */
        .trust-badges {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 8px 0;
            font-size: 0.85rem;
        }

        .trust-badges .container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }

        .top-header {
            background: var(--header-bg);
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .top-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .contact-info {
            display: flex;
            gap: 25px;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .auth-buttons {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .auth-buttons button {
            padding: 8px 20px;
            border: 1px solid var(--primary);
            background: transparent;
            color: var(--primary);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            white-space: nowrap;
        }

        .auth-buttons button:hover {
            background: var(--primary);
            color: var(--white);
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--gray);
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .main-header {
            background: var(--header-bg);
            padding: 20px 0;
            box-shadow: var(--shadow);
        }

        .logo-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .search-bar {
            display: flex;
            max-width: 500px;
            flex: 1;
            min-width: 250px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            font-size: 1rem;
            background: var(--bg-color);
            color: var(--text-color);
            min-width: 0;
        }

        .search-bar button {
            padding: 0 20px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            flex-shrink: 0;
        }

        .user-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--border-radius-sm);
            position: relative;
            min-width: 60px;
        }

        .action-item:hover {
            background: var(--light);
        }

        .cart-count {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--accent);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        nav {
            background: var(--primary-dark);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 5px;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: var(--white);
            text-decoration: none;
            padding: 16px 20px;
            display: block;
            border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
            font-weight: 500;
            white-space: nowrap;
        }

        .nav-links a:hover, .nav-links a.active {
            background: var(--primary);
        }

        /* Main Content */
        main {
            flex: 1;
            width: 100%;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: var(--white);
            padding: 60px 0;
            width: 100%;
        }

        .hero .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: center;
        }

        .hero-content h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero-content p {
            font-size: 1.1rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--secondary);
            color: var(--dark);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--primary);
        }

        .hero-image img {
            width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
        }

        /* Products */
        .products {
            padding: 60px 0;
            background: var(--bg-color);
            width: 100%;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            width: 100%;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            width: 100%;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            height: 200px;
            overflow: hidden;
            position: relative;
            background: var(--light);
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .seller-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-online {
            color: var(--success);
        }

        .status-offline {
            color: var(--gray);
        }

        /* Success Messages */
        .success-message {
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .compression-info {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
            text-align: center;
        }

        /* Seller Dashboard */
        .seller-dashboard {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            margin: 40px 0;
            box-shadow: var(--shadow);
            width: 100%;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 1rem;
        }

        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: var(--light);
        }

        .file-upload input {
            display: none;
        }

        .image-preview {
            margin-top: 15px;
            text-align: center;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: var(--border-radius-sm);
            border: 2px solid var(--border-color);
        }

        .upload-progress {
            margin-top: 10px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            height: 10px;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        /* Loading Animations */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        .loading.primary {
            border: 3px solid var(--primary);
            border-top-color: transparent;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* About Us Page */
        .about-page {
            padding: 60px 0;
            background: var(--bg-color);
            width: 100%;
        }

        .about-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .about-section {
            margin-bottom: 40px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .about-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 10px;
        }

        /* Footer */
        footer {
            background: var(--footer-bg);
            color: var(--white);
            padding: 40px 0 20px;
            width: 100%;
            margin-top: auto;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero .container {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 30px;
            }
            
            .hero-content h1 {
                font-size: 2rem;
            }
            
            .logo-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-bar {
                max-width: 100%;
            }
            
            .user-actions {
                justify-content: center;
            }
            
            .contact-info {
                justify-content: center;
            }
            
            .auth-buttons {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 15px;
            }
            
            .hero {
                padding: 40px 0;
            }
            
            .products {
                padding: 40px 0;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-links a {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="trust-badges">
            <div class="container">
                <span><i class="fas fa-shield-alt"></i> 100% Secure</span>
                <span><i class="fas fa-truck"></i> Free Shipping ₦10k+</span>
                <span><i class="fas fa-undo"></i> 7-Day Returns</span>
                <span><i class="fas fa-headset"></i> 24/7 Support</span>
            </div>
        </div>

        <div class="top-header">
            <div class="container">
                <div class="contact-info">
                    <span><i class="fas fa-phone"></i> 0806 456 2826</span>
                    <span><i class="fas fa-envelope"></i> info@mainmarketonitsha.com</span>
                </div>
                <div class="auth-buttons">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button id="loginBtn">Login</button>
                    <button id="registerBtn">Register</button>
                    <button id="logoutBtn" style="display: none;">Logout</button>
                </div>
            </div>
        </div>
        
        <div class="main-header">
            <div class="container">
                <div class="logo-section">
                    <div class="logo" onclick="showHomePage()">
                        <i class="fas fa-shopping-bag"></i>
                        <div>
                            <span style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">Main Market</span>
                            <span style="font-size: 0.9rem; color: var(--dark);">Onitsha</span>
                        </div>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search for products...">
                        <button id="searchBtn"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <div class="user-actions">
                        <div class="action-item" id="userAccount">
                            <i class="fas fa-user"></i>
                            <span>Account</span>
                        </div>
                        <div class="action-item" id="sellerDashboardBtn">
                            <i class="fas fa-store"></i>
                            <span>Seller</span>
                        </div>
                        <div class="action-item cart-item" id="viewCart">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Cart</span>
                            <div class="cart-count">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <nav>
            <div class="container">
                <ul class="nav-links">
                    <li><a href="#" class="nav-link active" onclick="showHomePage()">Home</a></li>
                    <li><a href="#" class="nav-link" onclick="showAboutPage()">About Us</a></li>
                    <li><a href="#" class="nav-link" onclick="showProducts()">Products</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main id="mainContent">
        <!-- Home Page (Default) -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <h1>Discover Authentic African Marketplace</h1>
                    <p>Connect directly with local sellers through live video chat. Support Nigerian businesses with secure transactions.</p>
                    <div class="hero-buttons">
                        <button class="btn btn-primary" onclick="showProducts()">
                            <i class="fas fa-shopping-bag"></i> Start Shopping
                        </button>
                        <button class="btn btn-secondary" onclick="showSellerDashboard()">
                            <i class="fas fa-store"></i> Sell Products
                        </button>
                    </div>
                </div>
                <div class="hero-image">
                    <img src="https://images.unsplash.com/photo-1563013546-7eab76c7af75?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="African Marketplace">
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section class="products" id="productsSection" style="display: none;">
            <div class="container">
                <h2 style="text-align: center; margin-bottom: 40px; color: var(--primary);">Featured Products</h2>
                <div id="loadingProducts" style="text-align: center; padding: 40px;">
                    <div class="loading primary" style="margin: 0 auto 15px;"></div>
                    <p>Loading products...</p>
                </div>
                <div class="product-grid" id="productGrid">
                    <!-- Products loaded by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Seller Dashboard -->
        <section id="sellerDashboard" style="display: none;">
            <div class="container">
                <div class="seller-dashboard">
                    <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">Add New Product</h2>
                    <form id="productForm">
                        <div class="form-group">
                            <label for="productName">Product Name *</label>
                            <input type="text" id="productName" required placeholder="Enter product name">
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Price (₦) *</label>
                            <input type="number" id="productPrice" required placeholder="Enter price" min="1">
                        </div>
                        <div class="form-group">
                            <label for="productDescription">Description *</label>
                            <textarea id="productDescription" rows="3" required placeholder="Describe your product..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="productCategory">Category *</label>
                            <select id="productCategory" required>
                                <option value="">Select Category</option>
                                <option value="fashion">Fashion</option>
                                <option value="electronics">Electronics</option>
                                <option value="home">Home & Living</option>
                                <option value="food">Food & Groceries</option>
                                <option value="beauty">Beauty & Health</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Product Image *</label>
                            <div class="file-upload" onclick="document.getElementById('productImage').click()">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
                                <p>Click to upload product image</p>
                                <p class="compression-info">Images will be compressed to 100KB for faster loading</p>
                                <input type="file" id="productImage" accept="image/*" onchange="previewImage(event)">
                            </div>
                            <div class="image-preview" id="imagePreview"></div>
                            <div class="upload-progress" id="uploadProgress" style="display: none;">
                                <div class="progress-bar" id="progressBar"></div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;" id="submitBtn">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- About Us Page -->
        <section id="aboutPage" class="about-page" style="display: none;">
            <div class="container">
                <div class="about-content">
                    <div class="about-section">
                        <h2>About Main Market Onitsha</h2>
                        <p>Main Market Onitsha is Nigeria's premier online marketplace, connecting buyers and sellers across the nation. Founded in 2020, we've grown to become the trusted platform for authentic African products and local businesses.</p>
                    </div>
                    
                    <div class="about-section">
                        <h2>Our Mission</h2>
                        <p>To empower Nigerian entrepreneurs by providing them with cutting-edge digital tools and nationwide reach. We believe every seller deserves access to both local and national markets.</p>
                    </div>
                    
                    <div class="about-section">
                        <h2>Why Choose Us?</h2>
                        <p>• Secure Payment System with Bank Transfer<br>
                           • 5 Physical Branches Nationwide for Pickup<br>
                           • 7-Day Return Policy<br>
                           • 24/7 Customer Support<br>
                           • Direct Seller Communication</p>
                    </div>
                    
                    <div class="about-section">
                        <h2>Our Branches</h2>
                        <p>• <strong>Onitsha Main Branch</strong> - Main Market Complex, Onitsha<br>
                           • <strong>Lagos Island Branch</strong> - 123 Broad Street, Lagos<br>
                           • <strong>Abuja Central Branch</strong> - Plot 456, CBD, Abuja<br>
                           • <strong>Port Harcourt Branch</strong> - 78 Aba Road, Port Harcourt<br>
                           • <strong>Ibadan Branch</strong> - Dugbe Market Complex, Ibadan</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Main Market Onitsha</h3>
                    <p>Connecting Nigerian buyers and sellers through technology and trust.</p>
                </div>
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-phone"></i> 0806 456 2826</p>
                    <p><i class="fas fa-envelope"></i> info@mainmarketonitsha.com</p>
                    <p><i class="fas fa-map-marker-alt"></i> 5 Branches Nationwide</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2024 Main Market Onitsha. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login to Your Account</h2>
                <button class="close-modal" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="loginSubmitBtn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <div style="text-align: center; margin-top: 15px;">
                    <p>Don't have an account? <a href="#" onclick="closeModal('loginModal'); document.getElementById('registerModal').style.display = 'flex';" style="color: var(--primary);">Register here</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Account</h2>
                <button class="close-modal" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email Address</label>
                    <input type="email" id="registerEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required placeholder="Create a password (min. 6 characters)">
                </div>
                <div class="form-group">
                    <label>Account Type</label>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <label style="flex: 1; text-align: center; padding: 15px; border: 2px solid var(--border-color); border-radius: var(--border-radius-sm); cursor: pointer;">
                            <input type="radio" name="userType" value="buyer" checked style="margin-right: 5px;">
                            <i class="fas fa-shopping-cart"></i><br>
                            Buyer
                        </label>
                        <label style="flex: 1; text-align: center; padding: 15px; border: 2px solid var(--border-color); border-radius: var(--border-radius-sm); cursor: pointer;">
                            <input type="radio" name="userType" value="seller" style="margin-right: 5px;">
                            <i class="fas fa-store"></i><br>
                            Seller
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="registerSubmitBtn">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                <div style="text-align: center; margin-top: 15px;">
                    <p>Already have an account? <a href="#" onclick="closeModal('registerModal'); document.getElementById('loginModal').style.display = 'flex';" style="color: var(--primary);">Login here</a></p>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCl90i83O7fkn4XolABcQ4bfQeo-OedQt8",
            authDomain: "mainmarketonitsha-a8d07.firebaseapp.com",
            projectId: "mainmarketonitsha-a8d07",
            storageBucket: "mainmarketonitsha-a8d07.firebasestorage.app",
            messagingSenderId: "118338230237",
            appId: "1:118338230237:web:624719a4cc3f91d0d90834"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // Global Variables
        let currentUser = null;
        let products = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Image compression function
        function compressImage(file, maxSizeKB = 100, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // Calculate new dimensions while maintaining aspect ratio
                        const maxDimension = 800;
                        if (width > height && width > maxDimension) {
                            height = (height * maxDimension) / width;
                            width = maxDimension;
                        } else if (height > maxDimension) {
                            width = (width * maxDimension) / height;
                            height = maxDimension;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // Convert to blob with quality adjustment
                        canvas.toBlob((blob) => {
                            if (blob.size / 1024 > maxSizeKB) {
                                // If still too large, reduce quality further
                                const reducedQuality = Math.max(0.3, quality * 0.8);
                                canvas.toBlob((smallerBlob) => {
                                    resolve(smallerBlob);
                                }, 'image/jpeg', reducedQuality);
                            } else {
                                resolve(blob);
                            }
                        }, 'image/jpeg', quality);
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            setupEventListeners();
            setupAuthStateListener();
            loadProductsFromFirebase();
            updateCartCount();
            checkSavedTheme();
        }

        // Firebase Authentication
        function setupAuthStateListener() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName
                    };
                    await checkUserRole(user.uid);
                } else {
                    currentUser = null;
                }
                updateAuthUI();
            });
        }

        async function checkUserRole(uid) {
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                if (userDoc.exists) {
                    currentUser.role = userDoc.data().role;
                }
            } catch (error) {
                console.error('Error checking user role:', error);
            }
        }

        // Page Navigation
        function showHomePage() {
            hideAllSections();
            document.querySelector('.hero').style.display = 'block';
            updateNavActive('home');
        }

        function showAboutPage() {
            hideAllSections();
            document.getElementById('aboutPage').style.display = 'block';
            updateNavActive('about');
        }

        function showProducts() {
            hideAllSections();
            document.getElementById('productsSection').style.display = 'block';
            loadProductsFromFirebase();
            updateNavActive('products');
        }

        function showSellerDashboard() {
            if (currentUser && currentUser.role === 'seller') {
                hideAllSections();
                document.getElementById('sellerDashboard').style.display = 'block';
            } else {
                showToast('Please register as a seller to add products', 'error');
                document.getElementById('registerModal').style.display = 'flex';
            }
        }

        function hideAllSections() {
            document.querySelector('.hero').style.display = 'none';
            document.getElementById('productsSection').style.display = 'none';
            document.getElementById('sellerDashboard').style.display = 'none';
            document.getElementById('aboutPage').style.display = 'none';
        }

        function updateNavActive(page) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
        }

        // Product Management with Firebase
        async function loadProductsFromFirebase() {
            try {
                document.getElementById('loadingProducts').style.display = 'block';
                document.getElementById('productGrid').innerHTML = '';
                
                const querySnapshot = await db.collection('products')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                products = [];
                querySnapshot.forEach((doc) => {
                    products.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderProducts();
                document.getElementById('loadingProducts').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('loadingProducts').innerHTML = `
                    <div style="text-align: center; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>Error loading products. Please check your connection.</p>
                    </div>
                `;
            }
        }

        function renderProducts() {
            const productGrid = document.getElementById('productGrid');
            
            if (products.length === 0) {
                productGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: var(--gray);">
                        <i class="fas fa-box-open" style="font-size: 4rem; margin-bottom: 20px;"></i>
                        <h3>No Products Yet</h3>
                        <p>Be the first to add a product!</p>
                        <button class="btn btn-primary" onclick="showSellerDashboard()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Add First Product
                        </button>
                    </div>
                `;
                return;
            }
            
            productGrid.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        <img src="${product.imageUrl}" alt="${product.name}" 
                             onerror="this.src='https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'">
                    </div>
                    <div class="product-info" style="padding: 20px;">
                        <h3 style="margin-bottom: 10px; font-size: 1.1rem;">${product.name}</h3>
                        <div style="font-size: 1.3rem; font-weight: bold; color: var(--primary); margin-bottom: 10px;">
                            ₦${product.price.toLocaleString()}
                        </div>
                        <p style="color: var(--gray); margin-bottom: 15px; font-size: 0.9rem; line-height: 1.4;">
                            ${product.description}
                        </p>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="font-size: 0.8rem; color: var(--gray); background: var(--light); padding: 4px 8px; border-radius: 12px;">
                                ${product.category}
                            </span>
                        </div>
                        <button class="btn btn-primary" onclick="addToCart('${product.id}')" style="width: 100%;">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Product Form Handler with Image Compression
        document.getElementById('productForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('Please login first', 'error');
                document.getElementById('loginModal').style.display = 'flex';
                return;
            }

            if (currentUser.role !== 'seller') {
                showToast('Please register as a seller first', 'error');
                return;
            }

            const productName = document.getElementById('productName').value;
            const productPrice = document.getElementById('productPrice').value;
            const productDescription = document.getElementById('productDescription').value;
            const productCategory = document.getElementById('productCategory').value;
            const productImage = document.getElementById('productImage').files[0];

            if (!productImage) {
                showToast('Please select a product image', 'error');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            try {
                submitBtn.innerHTML = '<div class="loading"></div> Compressing Image...';
                submitBtn.disabled = true;

                // Show progress bar
                document.getElementById('uploadProgress').style.display = 'block';
                
                // Compress image first
                const compressedBlob = await compressImage(productImage, 100, 0.7);
                
                document.getElementById('progressBar').style.width = '30%';
                submitBtn.innerHTML = '<div class="loading"></div> Uploading...';
                
                // Upload compressed image to Firebase Storage
                const storageRef = storage.ref();
                const imageRef = storageRef.child(`products/${Date.now()}_${productImage.name}`);
                
                const uploadTask = imageRef.put(compressedBlob);
                
                // Track upload progress
                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = 30 + (snapshot.bytesTransferred / snapshot.totalBytes) * 70;
                        document.getElementById('progressBar').style.width = progress + '%';
                    },
                    (error) => {
                        console.error('Upload error:', error);
                        showToast('Image upload failed: ' + error.message, 'error');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        document.getElementById('uploadProgress').style.display = 'none';
                    },
                    async () => {
                        // Upload completed
                        const imageUrl = await uploadTask.snapshot.ref.getDownloadURL();

                        // Save product to Firestore
                        await db.collection('products').add({
                            name: productName,
                            price: parseInt(productPrice),
                            description: productDescription,
                            category: productCategory,
                            imageUrl: imageUrl,
                            sellerId: currentUser.uid,
                            sellerEmail: currentUser.email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // Show success message
                        const successMessage = document.createElement('div');
                        successMessage.className = 'success-message';
                        successMessage.innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            Product added successfully!
                        `;
                        document.getElementById('productForm').prepend(successMessage);

                        // Reset form and UI
                        setTimeout(() => {
                            this.reset();
                            document.getElementById('imagePreview').innerHTML = '';
                            document.getElementById('uploadProgress').style.display = 'none';
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                            successMessage.remove();
                            
                            loadProductsFromFirebase();
                            showProducts();
                        }, 2000);
                        
                    }
                );
                
            } catch (error) {
                console.error('Error adding product:', error);
                showToast('Error adding product: ' + error.message, 'error');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                document.getElementById('uploadProgress').style.display = 'none';
            }
        });

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                // Validate file type
                if (!file.type.match('image.*')) {
                    showToast('Please select an image file', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <p style="margin-top: 10px; font-size: 0.8rem; color: var(--gray);">
                            ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB) - Will be compressed to 100KB
                        </p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        // Shopping Cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                cart.push(product);
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                showToast(`${product.name} added to cart!`);
            }
        }

        function updateCartCount() {
            document.querySelector('.cart-count').textContent = cart.length;
        }

        // Auth Functions with Loading Animations
        function setupEventListeners() {
            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'flex';
            });

            document.getElementById('registerBtn').addEventListener('click', () => {
                document.getElementById('registerModal').style.display = 'flex';
            });

            document.getElementById('sellerDashboardBtn').addEventListener('click', showSellerDashboard);

            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Login form
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const submitBtn = document.getElementById('loginSubmitBtn');
                const originalText = submitBtn.innerHTML;
                
                try {
                    submitBtn.innerHTML = '<div class="loading"></div> Logging in...';
                    submitBtn.disabled = true;
                    
                    await auth.signInWithEmailAndPassword(email, password);
                    closeModal('loginModal');
                    showToast('Login successful!');
                } catch (error) {
                    showToast('Login failed: ' + error.message, 'error');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });

            // Register form
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const userType = document.querySelector('input[name="userType"]:checked').value;
                const submitBtn = document.getElementById('registerSubmitBtn');
                const originalText = submitBtn.innerHTML;
                
                try {
                    submitBtn.innerHTML = '<div class="loading"></div> Creating account...';
                    submitBtn.disabled = true;
                    
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await userCredential.user.updateProfile({
                        displayName: name
                    });

                    // Save user role to Firestore
                    await db.collection('users').doc(userCredential.user.uid).set({
                        name: name,
                        email: email,
                        role: userType,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // Show success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'success-message';
                    successMessage.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        Registration successful! Welcome ${name}
                    `;
                    document.getElementById('registerForm').prepend(successMessage);

                    setTimeout(() => {
                        closeModal('registerModal');
                        successMessage.remove();
                    }, 2000);
                    
                } catch (error) {
                    showToast('Registration failed: ' + error.message, 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userAccount = document.getElementById('userAccount');

            if (currentUser) {
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                userAccount.querySelector('span').textContent = currentUser.displayName || 'Account';
            } else {
                loginBtn.style.display = 'block';
                registerBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                userAccount.querySelector('span').textContent = 'Account';
            }
        }

        async function handleLogout() {
            try {
                await auth.signOut();
                showToast('Logged out successfully');
            } catch (error) {
                showToast('Logout failed: ' + error.message, 'error');
            }
        }

        // Dark Mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const themeToggle = document.getElementById('themeToggle');
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                localStorage.setItem('theme', 'light');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Check for saved theme
        function checkSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        // Utility Functions
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showToast(message, type = 'success') {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = `toast ${type === 'error' ? 'error' : ''}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : 'exclamation-triangle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>
</body>
</html>
